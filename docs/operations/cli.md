# Haven CLI Tool

The Haven CLI provides command-line access to git diff generation and analysis features with professional HTML output powered by diff2html.

## Installation

The CLI is automatically installed when you install the Haven API package:

```bash
cd apps/api
pip install -e ".[dev]"
```

This installs the `haven-cli` command globally.

## Commands

### `haven-cli list-commits`

List commits that would be included in diff generation.

```bash
# List commits on current branch vs main
haven-cli list-commits

# List commits in specific repository
haven-cli list-commits --repo-path /path/to/repo

# List commits vs different base branch
haven-cli list-commits --base-branch develop
```

**Options:**
- `--repo-path, -r`: Path to git repository (default: current directory)
- `--base-branch, -b`: Base branch for comparison (default: main)

### `haven-cli generate`

Generate diff files for all commits in the repository.

```bash
# Generate diffs with default settings
haven-cli generate

# Generate with verbose output
haven-cli generate --verbose

# Specify output directory
haven-cli generate --output-dir my-diffs

# Generate for specific repository and base branch
haven-cli generate --repo-path /path/to/repo --base-branch develop
```

**Options:**
- `--repo-path, -r`: Path to git repository (default: current directory)
- `--base-branch, -b`: Base branch for comparison (default: main)
- `--output-dir, -o`: Output directory for diff files (default: diff-output)
- `--verbose, -v`: Verbose output

**Output:**
- Individual `.html` files for each commit (generated by diff2html)
- `index.html` file with interactive summary and links to all diffs

**Prerequisites:**
The CLI requires diff2html-cli to be installed. It will attempt to install it automatically via npm if not found:
```bash
npm install -g diff2html-cli
```

## Examples

### Basic Usage

```bash
# List what commits would be processed
haven-cli list-commits

# Generate diffs for current repository
haven-cli generate --verbose

# View results in browser
open diff-output/index.html
```

### Advanced Usage

```bash
# Generate diffs for feature branch vs develop
haven-cli generate \
  --repo-path ~/projects/my-app \
  --base-branch develop \
  --output-dir feature-diffs \
  --verbose
```

### Integration with Just Commands

The Haven project includes integration with Just commands for easy access:

```bash
# Use CLI through Just commands
just cli-list-commits                    # List commits
just cli-generate                       # Generate diffs
just cli-generate-to /path/to/output    # Generate to specific directory

# Alternative approaches
just demo-commits           # Full demo with auto-server startup
just demo-diff-generation   # Uses API server (requires manual startup)
haven-cli generate          # Direct CLI tool
```

## Output Format

The CLI generates professional HTML output using diff2html:

1. **Individual diff files**: `01-abc12345-commit-message.html`
   - Numbered sequentially
   - Include short commit hash
   - Sanitized commit message in filename
   - Side-by-side diff view with syntax highlighting
   - Code folding and navigation features

2. **Index file**: `index.html`
   - Interactive HTML dashboard
   - Clickable commit list with hover effects
   - Statistics summary (total commits, contributors, date range)
   - Direct links to individual diff files
   - Commit metadata (hash, author, date, message)
   - Responsive design for mobile and desktop

## Error Handling

The CLI provides clear error messages for common issues:

- **Not a git repository**: Ensure you're in a git repository
- **Base branch not found**: Check that the base branch exists
- **No commits found**: May indicate you're already on the base branch
- **diff2html not available**: The CLI will attempt automatic installation via npm
- **diff generation failed**: Individual commit diffs that fail are skipped with warnings

## Performance

- Uses async operations for better performance
- Processes commits sequentially to maintain order
- Minimal memory usage for large repositories
- Progress indicators with `--verbose` flag
- diff2html generates optimized HTML with built-in performance features
- Automatic diff2html dependency management

## See Also

- [API Documentation](api/diff-generation.md) - Web API for diff generation
- [Demo Scripts](../scripts/) - Automated demo workflows
- [Architecture](architecture.md) - System design and patterns