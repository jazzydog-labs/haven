Below is a **local-only “headless” playbook** that makes Claude Code a fully-autonomous builder inside your terminal.
Follow the steps once; after that, you can ask Claude itself to extend or revise its own setup.

---

### 1  Install the CLI where your shell can find it

```bash
npm install -g @anthropic-ai/claude-code      # no sudo needed
claude doctor                                 # verify install
```

The standard install script is the same one shown in Anthropic’s quick-start docs. ([Anthropic][1])

---

### 2  Give the bot wide-open rights *inside this repo only*

1. `mkdir -p .claude`
2. Create **`.claude/settings.json`**:

```json
{
  "defaultMode": "bypassPermissions",
  "permissions": {
    "allow": ["Bash(*)", "Edit(*)", "Write(*)", "Read(*)"],
    "deny": []
  },
  "hooks": {}
}
```

* `bypassPermissions` skips every approval prompt; Anthropic lists it as the most permissive mode. ([Anthropic][2])
* The sandbox still keeps Claude’s edits inside the current directory tree. ([Anthropic][3])

---

### 3  Expose your API key just for this shell

```bash
export ANTHROPIC_API_KEY=<your-key>
```

No other environment is required for local use, but you can later add OpenTelemetry vars if you want traces (same keys the docs show for CI). ([Anthropic][1])

---

### 4  Teach Claude your project conventions via hooks

> **One-time bootstrap**: run Claude in interactive mode and ask it to create the hooks file.

```bash
claude                                   # drops you into the REPL
> Add a Stop hook that automatically runs `just lint type test`
  and blocks if any step fails. Then add a PreToolUse hook that
  wraps every Bash command in `timeout 300`.
```

Claude will open an editor pane, write the JSON, and save it back into `.claude/settings.json`. The hook mechanism and file locations come straight from the hooks reference. ([Anthropic][4])

If you prefer fully unattended bootstrapping, run the same request non-interactively:

```bash
claude -p --permission-mode bypassPermissions \
       "Create the Stop and PreToolUse hooks described in SPEC.md"
```

(`-p` tells Claude to read a prompt from the CLI flag rather than entering the REPL. ([Anthropic][5]))

---

### 5  Add convenience wrappers to your **Justfile**

```make
# Ensure Claude CLI exists before every call
_ensure_claude := npm list -g @anthropic-ai/claude-code >/dev/null || \
                  npm i -g @anthropic-ai/claude-code

cli := claude --permission-mode bypassPermissions --model claude-3-sonnet-20250715

just claude args...:
	$(_ensure_claude)
	$(cli) -- "$$args"

just plan task:
	just claude "Plan how to implement: $(task)"

just implement:
	just claude "Implement pending tasks in todo.md and update docs"
```

Now you can run `just plan "Add Tag entity"` or `just implement` and watch Claude iterate until tests pass.

---

### 6  Quality guardrails the bot must satisfy

Create **`guardrails/checklist.yaml`** (or append to `CLAUDE.md`) so Claude can read it:

```yaml
quality:
  lint: "ruff --quiet ."
  type: "pyright"
  test: "pytest --cov=haven --cov-fail-under=70"
  docs: "mkdocs build -q"
```

Claude Code parses external checklists to decide when its task is done, mirroring the “definition-of-done” pattern in the docs’ common workflows section. ([Anthropic][6])

---

### 7  Daily usage pattern

```bash
# 1. Add or check a box in todo.md
# 2. Run automated implementation
just implement

# 3. Review git diff, commit, push
git diff
git commit -am "feat: auto-generated by Claude"
```

Under `bypassPermissions`, Claude will:

* edit code, docs, or config directly
* run `just lint type test` via the Stop hook
* refuse to finish until the guardrail commands succeed

No user approval loops are required.

---

### 8  Optional niceties

* **Shell alias**: `alias cc='just claude'` for quick prompts.
* **Telemetry**: `export CLAUDE_CODE_ENABLE_TELEMETRY=1` + OTLP variables to collect run metrics. ([Anthropic][1])
* **Terminal tweaks**: follow the terminal-config guide for prompt theming and keybindings. ([Anthropic][7])

---

### 9  Safety reminders

* Keep your Anthropic key scoped to a non-production account; `bypassPermissions` trusts the agent completely.
* If something goes wrong, delete `.claude/settings.json` or unset `ANTHROPIC_API_KEY`—Claude will immediately lose write powers.

---

**Result:** you now have a self-bootstrapping, self-testing Haven engineer that lives entirely in your CLI, needs no CI server, and still obeys the same guardrails you defined in SPEC.md.

[1]: https://docs.anthropic.com/en/docs/claude-code/setup?utm_source=chatgpt.com "Set up Claude Code - Anthropic API"
[2]: https://docs.anthropic.com/en/docs/claude-code/iam?utm_source=chatgpt.com "Identity and Access Management - Anthropic API"
[3]: https://docs.anthropic.com/en/docs/claude-code/security?utm_source=chatgpt.com "Security - Anthropic API"
[4]: https://docs.anthropic.com/en/docs/claude-code/hooks?utm_source=chatgpt.com "Hooks reference - Anthropic API"
[5]: https://docs.anthropic.com/en/docs/claude-code/cli-reference?utm_source=chatgpt.com "CLI reference - Anthropic API"
[6]: https://docs.anthropic.com/en/docs/claude-code/quickstart?utm_source=chatgpt.com "Quickstart - Anthropic API"
[7]: https://docs.anthropic.com/en/docs/claude-code/interactive-mode?utm_source=chatgpt.com "Interactive mode - Keyboard shortcuts - Anthropic API"
